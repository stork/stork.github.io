// ===============================================================================
//
//  Custom implementation of Twitter Bootstrap Typeahead plugin
//  http://twitter.github.com/bootstrap/javascript.html#typeahead
//
//  v1.0.1
//  Terry Rosen  -  @rerrify
//
//  Requires jQuery 1.7+ and Twitter Bootstrap
//
!function(a){"use strict";var b=function(b,c){this.$element=a(b);this.options=a.extend({},a.fn.typeahead.defaults,c);this.$menu=a(this.options.menu).appendTo("body");this.source=this.options.source;this.shown=false;this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.select=this.options.select||this.select;this.render=this.options.render||this.render;this.listen()};b.prototype={constructor:b,select:function(){var a=this.$menu.find(".active");this.$element.val(a.text());this.options.itemSelected(a,a.attr("data-value"),a.text());return this.hide()},show:function(){var b=a.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:b.top+b.height,left:b.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(b){var c=this;var d;var e;this.query=this.$element.val();if(!this.query){return this.shown?this.hide():this}d=a.grep(this.source,function(a){var b=a[c.options.matchProp]||a;if(c.matcher(b))return a});d=this.sorter(d);if(!d.length){return this.shown?this.hide():this}return this.render(d.slice(0,this.options.items)).show()},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){var b=this;var c=[];var d=[];var e=[];var f;while(f=a.shift()){var g=f[b.options.matchProp]||f;if(!g.toLowerCase().indexOf(this.query.toLowerCase()))c.push(f);else if(~g.indexOf(this.query))d.push(f);else e.push(f)}return c.concat(d,e)},highlighter:function(a){return a.replace(new RegExp("("+this.query+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;b=a(b).map(function(b,d){b=a(c.options.item).attr("data-value",d[c.options.valueProp]||d);if(b){b.find("a").html(c.highlighter(d[c.options.matchProp]||d));return b[0]}});b.first().addClass("active");this.$menu.html(b);return this},next:function(b){var c=this.$menu.find(".active").removeClass("active");var d=c.next();if(!d.length){d=a(this.$menu.find("li")[0])}d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active");var c=b.prev();if(!c.length){c=this.$menu.find("li").last()}c.addClass("active")},listen:function(){this.$element.on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this));if(a.browser.webkit||a.browser.msie){this.$element.on("keydown",a.proxy(this.keypress,this))}this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this))},keyup:function(a){a.stopPropagation();a.preventDefault();switch(a.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:this.hide();break;default:this.lookup()}},keypress:function(a){a.stopPropagation();if(!this.shown)return;switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault();this.prev();break;case 40:a.preventDefault();this.next();break}},blur:function(a){var b=this;a.stopPropagation();a.preventDefault();setTimeout(function(){b.hide()},150)},click:function(a){a.stopPropagation();a.preventDefault();this.select()},mouseenter:function(b){this.$menu.find(".active").removeClass("active");a(b.currentTarget).addClass("active")}};a.fn.typeahead=function(c){return this.each(function(){var d=a(this);var e=d.data("typeahead");var f=typeof c=="object"&&c;if(!e)d.data("typeahead",e=new b(this,f));if(typeof c=="string")e[c]()})};a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',matchProp:"name",sortProp:"name",valueProp:"id",itemSelected:function(){}};a.fn.typeahead.Constructor=b;a(function(){a("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);if(c.data("typeahead"))return;b.preventDefault();c.typeahead(c.data())})})}(window.jQuery)